# keepalived.conf file

vrrp_script chk_nginx {
	script "killall -0 nginx"
	interval 2 #check every 2 seconds
}

vrrp_instance VI_1 {
	interface eth0
	state MASTER #both machines can be master, decided by priority
	virtual_router_id 51
	priority {{ priority2 }} # Higher priority on the master and lower on the backup
	vrrp_unicast bind {{ domain2 }}
	vrrp_unicast_peer {{ domain1 }}
	virtual_ipaddress {
		"{{ floating_ip }} dev eth0 label eth0:vip"
	}

	track_script {
		chk_nginx weight 2
	}
}
